<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>信息列表</title>
<style>
html, body {
	background: #dae6f3;
	font: 14px Arial, Helvetica, sans-serif;
}
table{
	font-size:14px;  /*表格*/
	padding-left:11px;
	border-collapse:collapse;
	border:#000000 1px solid;
	background-color:#EFEFEF;
}
.tr{
	background-color:#336699;
	color:#FFFFFF;
	height:20px;
}
td{
	border:#000000 1px solid;
	height:20px;
}
.td1{
}
fieldset{
	width:400px;
	border:1px solid #33CCFF;
	text-align:center;
}
div{
	float:left;
	margin:0px 0px 0px 0px;
	padding:5px 5px 0px 5px;
	/*border:1px solid #DEDEB8;*/
	border:none;
	font-size:14px;
}
div.div1{
	float:left;
	margin:0px 0px 0px 0px;
	padding:0px 0px 0px 5px;
}
a{
	text-decoration:none;
	font-size:14px;
	color:#000000;
}
a:hover{
	color:#000000;
	text-decoration:underline;
}
</style>
</head>

<body>
<!--按栏目查询-->
<select name='sub_menu_id' id='sub_menu_id'>
  !--{$menu_id}--
</select>
<!--按作者查询-->
<select name='user_id' id='user_id'>
  !--{$user_id}--
</select>
<!--按审核状态查询-->
<select name='audit_state' id='audit_state'>
  !--{$audit_state}--
</select>
<!--按标题关键字查询-->
<input type="text" name="key_word" id="key_word" value="!--{$key_word}--" size="20" />
<input type="button" id="search" name="search" value="确定" onclick="search()"/>
<script type="text/javascript">
function search(){
	var filter_sub_menu=document.getElementById('sub_menu_id').value;
	var filter_user_id=document.getElementById('user_id').value;
	var filter_audit_state=document.getElementById('audit_state').value;	
	var filter_key_word=document.getElementById('key_word').value;	
	var url="/management/news/list/current_page/!--{$current_page}--/first_coming/yes/"+
	"orderBy//"+
	"filter_sub_menu/"+filter_sub_menu+
	"/filter_user_id/"+filter_user_id+
	"/filter_audit_state/"+filter_audit_state+
	"/filter_key_word/"+filter_key_word
	;
	//alert(url);
	document.location=url;
}
</script>
<br />
<br />
<table width="100%">
  <tr class="tr">
    <td width="14%">所属栏目</td>
    <td width="40%">信息标题</td>
    <td width="8%">作者</td>
    <td width="4%">附件</td>
    <td width="12%">发表时间</td>
    <td width="4%">点击</td>
    <td width="4%">范围</td>
    <td width="4%">状态</td>
    <td width="10%">操作</td>
  </tr>

  !--{section name=list1}--
  <tr>
    <td id='!--{list1.td_news_id}--' style="display:none"  >!--{list1.news_id}--</td>
    <td id='!--{list1.td_sub_menu_id}--'    >!--{list1.sub_menu_id}--</td>
    <td id='!--{list1.td_title}--'    >!--{list1.title}--</td>
	<td id='!--{list1.td_user_name}--'    >!--{list1.user_name}--</td>
	<td id='!--{list1.td_attachment}--'    >!--{list1.attachment}--</td>
    <td id='!--{list1.td_date_update}--'   >!--{list1.date_update}--</td>
    <td id='!--{list1.td_hit_times}--'   >!--{list1.hit_times}--</td>
    <td id='!--{list1.td_target}--'   >!--{list1.target}--</td>
    <td id='!--{list1.td_visible}--'   >!--{list1.visible}--</td>
    <td>
	<a href="#" onclick="do_action('!--{list1.news_id}--','edit')">编辑</a>
	<a href="#" onclick="do_action('!--{list1.news_id}--','delete')">删除</a>
	</td>
  </tr>
  !--{/section}--
</table>
<div style="height:20px;">
<a href="/management/news/add/filter_user_id/!--{$filter_user_id}--/filter_sub_menu/!--{$filter_sub_menu}--" class="pageline"><font color="Red" size="3">新增</font></a>
</div>
<div style="height:20px;">
共!--{$max_rows}--条记录 当前第<label id='current_page' name='current_page'>!--{$current_page_display}--</label>页 共!--{$max_page}--页
</div>
<div style="height:20px;">

<!--<a href="/management/news/list/page_action/pre/current_page/!--{$current_page}--/first_coming/yes" id='pre' name='pre' class="pageline">上一页</a>
-->
<a href="/management/news/list/page_action/top/!--{$url}--" id='pre' name='pre' class="pageline">首页</a>
<a href="/management/news/list/page_action/pre/!--{$url}--" id='pre' name='pre' class="pageline">上一页</a>
</div>
<div style="height:20px;">
<!--<a href="/management/news/list/page_action/next/current_page/!--{$current_page}--/first_coming/yes" id='next' name='next' class="pageline" >下一页</a>
-->
<a href="/management/news/list/page_action/next/!--{$url}--" id='next' name='next' class="pageline">下一页</a>
<a href="/management/news/list/page_action/bottom/!--{$url}--" id='next' name='next' class="pageline">尾页</a>
</div>
<div style="height:20px;">
<a href="/default/index/index" target="_parent"parent">返回首页</a>
</div>
<input type="hidden" id="alert_delete" name="alert_delete" value="!--{$alert_delete}--">
</body>
</html>
<script language="javascript">


/**
全局变量xmlHttp对象实例
*/
var xmlHttp = false;
var page_obj = false;
var page_obj_innertext='';

function change_state()
{

	//
	if(page_obj.disabled==false)
	{
		page_obj_innertext=page_obj.innerText;
		page_obj.disabled=true;
		page_obj.innerText='正在读取数据';//暂时不用
	}
	else
	{
		if (xmlHttp.readyState == 4)
		{

			if(xmlHttp.responseText=='error code 0 no data found')
			{
				alter('error code 0 no data found');
				return;
			}
			//alert(xmlHttp.responseText);
			var responseText = eval('('+xmlHttp.responseText+')');
			//alert(responseText);
			var table=responseText['table'];
			//alert(table);
			var current_page=responseText['state'];
			//alert(current_page[0]['current_page']);
			//alert(table.length);

			for(var row=0;row<table.length;row++)
			{
				//alert(table[row].name);
				td_change_innertext(table,'news_id',row);
				td_change_innertext(table,'sub_menu_id',row);
				td_change_innertext(table,'title',row);
				td_change_innertext(table,'attachment',row);
				td_change_innertext(table,'date_update',row);
				td_change_innertext(table,'hit_times',row);
				td_change_innertext(table,'target',row);
				td_change_innertext(table,'visible',row);
			}
			var obj_current_page=document.getElementById('current_page');
			//alert(obj_current_page.value);
			page_obj.disabled=false;
			obj_current_page.innerText=parseInt(current_page[0]['current_page'])+1;
			//alert(page_obj_innertext);
			page_obj.innerText=page_obj_innertext;//暂时不用，保留
		}
	}
	return;
}
function ajaxturnpage(obj,action)
{
	page_obj=obj;
	//如果本次翻页操作还没有成功，按钮还处于灰化状态，则禁止继续操作
	if(page_obj.disabled==true)
	{
		return false;
	}
	//xmlHttp =new ActiveXObject("Microsoft.XMLHTTP");
	//alert(xmlHttp);
	xmlHttp=xmlhttp_factory();
	//alert(xmlHttp);
	//xmlHttp.setRequestHeader( "Content-Type" , "multipart/form-data");
	//alert(current_page);
	//var obj_current_page;
	var obj_current_page=document.getElementById('current_page');
	//alert(obj_current_page.innerText);
	//obj_current_page=document.all('current_page');
	//alert(obj_current_page);
	var current_page=parseInt(obj_current_page.innerText)-1;
	//alert(current_page);

	get_string="/management/news/list/page_action/"+action+"/current_page/"+current_page+"/turn_page_type/ajax/math_id/"+Math.random();
	//这样处理的主要目的是防止缓存
	//alert(get_string);
	xmlHttp.open("GET", get_string, true);
	xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded" );
	//var str=get_value();
	//alert(get_string);
	xmlHttp.onreadystatechange= change_state;

	xmlHttp.send(get_string);

	//alert('a');
	//xmlHttp.onreadystatechange= change_state;
	//page_obj.disabled=false;

}
function td_change_innertext(table,column,row)
{
	var obj_name='td_'+column+'_'+row;
	var td_obj=document.getElementById(obj_name);
	//alert(obj_name);
	td_obj.innerText=table[row][column];
	//td_obj.innerht=table[row][column];

}
/**
根据不同的动作参数完成编辑或是删除操作
row表示是哪一行的动作发生了。
根据row提供的行号，加上'td_id_'+row形成隐藏列的列id，取得id形成url
*/
function do_action(row,action){
	alert(row+action);

	var obj_current_page=document.getElementById('current_page');
	var current_page=parseInt(obj_current_page.innerText)-1;
	//不同的列表里要修改这里
	var obj_id='td_news_id_'+row;
	//alert(obj_id);

	var obj_id=document.getElementById(obj_id);
	//var id=	obj_id.innerText;
	var newsId=row;
	if(newsId.length<3)
	{
		alert("没有数据的空行，不能编辑或删除");
		return false;
	}
	if(!confirm("确定吗？")){
		return false;
	}
	if(action=='edit'){
		url="/management/news/display/news_id/"+newsId+"/current_page/"+current_page+"/!--{$url}--";
		//alert(url);
	}
	if(action=='delete'){
		url="/management/news/delete/news_id/"+newsId+"/current_page/"+current_page+"/!--{$url}--";
	}
	document.location=url;

}
/**
实例化一个http对象
*/
function xmlhttp_factory()
{
	/*@cc_on @*/
	/*@if (@_jscript_version >= 5)
	try {
	xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
	} catch (e) {
	try {
	xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
	} catch (e2) {
	xmlHttp = false;
	}
	}
	@end @*/
	if (!xmlHttp && typeof XMLHttpRequest != 'undefined') {
		xmlHttp = new XMLHttpRequest();
	}
	return xmlHttp;
}


var temp_obj=document.getElementById('alert_delete');
var alert_delete=temp_obj.value;
//alert(alert_delete);
if(alert_delete!='')
{
	if(alert_delete=='prohibit')
	{
		alert('此数据禁止删除！');
	}
	if(alert_delete=='success')
	{
		alert('数据已成功删除！');
	}
	//alert(alert_delete);
}
</script>
