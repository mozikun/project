<?php
class api_etController extends controller {
	public function initAction(){
	}
	public function ws_etAction(){
		require_once(__SITEROOT.'application/api/models/api_phs_et_index.php');		
		$server = new SoapServer(__SITEROOT.'wsdl/api_phs_et_index.wsdl');
		$server->setClass('api_phs_et_index');		      
        $server->handle();
	}
	public function ws_et_resultAction(){
		$soapclient = new SoapClient('http://'.$_SERVER['SERVER_NAME'].':'.$_SERVER['SERVER_PORT'].'/wsdl/api_phs_et_index.wsdl');

	}
	/**
	 * 用于生成wsdl
	 *
	 */
	public function generate_wsdlAction(){
		$class_name='api_phs_et_index';
		require_once(__SITEROOT."application/api/models/".$class_name.".php");
		require_once(__SITEROOT."library/custom/SoapDiscovery.class.php");
		$wsdl_object = new SoapDiscovery($class_name,$class_name,"/api/et/ws_et");
		$xml_file=$wsdl_object->getWSDL();
		$fp=fopen(__SITEROOT.'wsdl/'.$class_name.'.wsdl',"w+");
		fputs($fp,$xml_file);
		fclose($fp);
	}	
	
	
	public function test_whereAction(){
		$soapclient = new SoapClient(__SITEROOT.'wsdl/api_phs_et_index.wsdl');
		$token      = $soapclient->ws_login('511804201','1');
		$xml_string="<?xml version='1.0' encoding='UTF-8'?><where><org_id>511804201</org_id><identity_number>513101193301152525</identity_number><ext_uuid>5555</ext_uuid></where>";
		echo $soapclient->ws_select_single($token,$xml_string);
	}
	public function test_updateAction(){
		$soapclient = new SoapClient(__SITEROOT.'wsdl/api_phs_et_index.wsdl');
		$token      = $soapclient->ws_login('511804201','1');
		$xml_string="<?xml version='1.0' encoding='UTF-8'?><tables><table name='examination_table'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><examination_date>1321891200</examination_date><examination_doctor>510824198308190834</examination_doctor><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_main_drug_use'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><drug_name>青霉素</drug_name><drug_usage>每天</drug_usage><drug_dosage>0.1</drug_dosage><drug_time>3</drug_time><drug_compliance>1</drug_compliance><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><drug_name>土霉素</drug_name><drug_usage>每天</drug_usage><drug_dosage>0.3</drug_dosage><drug_time>4</drug_time><drug_compliance>1</drug_compliance><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_operation_history'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><put_bed_time>1322006400</put_bed_time><receive_bed_time>1322092800</receive_bed_time><reason>xxx22222原因</reason><organization>医院3</organization><record_no></record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><put_bed_time>1321920000</put_bed_time><receive_bed_time>1321488000</receive_bed_time><reason>xxx11111原因</reason><organization>医院24</organization><record_no></record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><put_bed_time>1321920000</put_bed_time><receive_bed_time>1321488000</receive_bed_time><reason>xxx11111原因</reason><organization>医院24</organization><record_no></record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_hospitalization_history'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><be_hospitalized_time>1321920000</be_hospitalized_time><leave_hospital_time>1322006400</leave_hospital_time><reason>xxx原因</reason><organization>医院2</organization><record_no>xxxx6666</record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><be_hospitalized_time>1321920000</be_hospitalized_time><leave_hospital_time>1321920000</leave_hospital_time><reason>vvv原因</reason><organization>医院1</organization><record_no>xxx003</record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><be_hospitalized_time>1321920000</be_hospitalized_time><leave_hospital_time>1321920000</leave_hospital_time><reason>vvv原因</reason><organization>医院1</organization><record_no>xxx003</record_no><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_nonepi_vaccination'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321929155</created><vaccination_name>非免疫规划预防史</vaccination_name><vaccination_time>1321401600</vaccination_time><vaccination_org>aaa机构</vaccination_org><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_examination'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><fbglucoseh>4.5</fbglucoseh><fbglucosee>4.8</fbglucosee><hemoglobin>0.3</hemoglobin><leukocyte>11</leukocyte><platelet>11</platelet><b_other>未知</b_other><u_protein>11</u_protein><urine>11</urine><ketone>11</ketone><uoblood>11</uoblood><u_other>11</u_other><microurine>11</microurine><fecalblood></fecalblood><alanine>11</alanine><serum>11</serum><albumin>11</albumin><tbilirubin>11</tbilirubin><bilirubin>11</bilirubin><screatinine>11</screatinine><bun>11</bun><serumpc>111</serumpc><sodium>11</sodium><tcholesterol>11</tcholesterol><triglyceride>11</triglyceride><lowcholesterol>11</lowcholesterol><highcholesterol>11</highcholesterol><ghemoglobin>11</ghemoglobin><hbsurface></hbsurface><fundus></fundus><veryfundus>眼底</veryfundus><ecg></ecg><veryecg>心电图</veryecg><xrayfilm></xrayfilm><veryxrayfilm>胸部X线片</veryxrayfilm><bc></bc><verybc>B 超</verybc><csmear></csmear><verycsmear>宫颈涂片</verycsmear><examination_other>111111</examination_other><criteria_rate></criteria_rate><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_general_condition'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><temperature>37</temperature><pulse>23</pulse><breathing_rate>12</breathing_rate><blood_pressure_left_s>34</blood_pressure_left_s><blood_pressure_left_p>45</blood_pressure_left_p><blood_pressure_right_s>44</blood_pressure_right_s><blood_pressure_right_p>55</blood_pressure_right_p><height>120</height><weight>45</weight><bmi>31.25</bmi><waistline>32</waistline><hipcircumference></hipcircumference><whi></whi><older_cognitive_functions></older_cognitive_functions><mmse>12</mmse><older_affective_state></older_affective_state><depression>10</depression><elder_health_status></elder_health_status><elder_living_skills></elder_living_skills><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_health_assessment'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><health_assessment></health_assessment><health_exception>异常1|异常2|异常3|</health_exception><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_identification'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><physical_medicine_name>1|2|3|4|5|6|7|8|9</physical_medicine_name><physical_medicine_val>2|2|2|2|2|2|2|2|2</physical_medicine_val><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_lifestyle'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><sport_frequence></sport_frequence><sport_time>23</sport_time><exercise_duration>3</exercise_duration><exercising_way></exercising_way><food_habit></food_habit><smoke></smoke><smoke_quantity>12</smoke_quantity><begin_smoke_age>12</begin_smoke_age><stop_smoke_age></stop_smoke_age><drink_frequency></drink_frequency><drink_quantity>12</drink_quantity><drink></drink><stop_drinking_age>12</stop_drinking_age><begin_drinking_age>12</begin_drinking_age><last_year_ntoxication></last_year_ntoxication><drink_style></drink_style><drink_style_other>黄酒</drink_style_other><occupational_exposure></occupational_exposure><occupation>钢筋工</occupation><occupation_age>2011</occupation_age><chemistry></chemistry><chemistry_protection>1</chemistry_protection><chemistry_protection_info></chemistry_protection_info><pest></pest><pest_protection>1</pest_protection><pest_protection_info></pest_protection_info><ray>X射线</ray><ray_protection></ray_protection><ray_protection_info>防辐射服</ray_protection_info><dust>煤灰</dust><dust_protection></dust_protection><dust_protection_info>面具</dust_protection_info><physical></physical><physical_protection></physical_protection><physical_protection_info></physical_protection_info><other_types>1</other_types><other_types_protection></other_types_protection><other_types_info></other_types_info><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_mhealth'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><ceredisease></ceredisease><ceredisease_status>3|4|6</ceredisease_status><ceredisease_other>脑血管疾病</ceredisease_other><kidneydisease></kidneydisease><kidneydisease_status>3|4|6</kidneydisease_status><kidneydisease_other>肾脏疾病</kidneydisease_other><heartdisease></heartdisease><heartdisease_status>4|7</heartdisease_status><heartdisease_other>心脏疾病</heartdisease_other><vasculardisease></vasculardisease><vasculardisease_status>2|4</vasculardisease_status><vasculardisease_other>血管疾病</vasculardisease_other><eyedisease></eyedisease><eyedisease_status>2|3|5</eyedisease_status><eyedisease_other>眼部疾病</eyedisease_other><nervousdisease></nervousdisease><nervousdisease_status></nervousdisease_status><nervousdisease_other>神经系统疾病</nervousdisease_other><otherdisease></otherdisease><otherdisease_status></otherdisease_status><otherdisease_other>其他系统疾病</otherdisease_other><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_organ'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><lips></lips><dentition>2</dentition><dentition_missing_teeth>2|1|4|3</dentition_missing_teeth><dentition_decayed_tooth></dentition_decayed_tooth><dentition_false_tooth></dentition_false_tooth><pharyngeal_portion></pharyngeal_portion><left_eye>1.0</left_eye><left_eye_corrected_vision>1.5</left_eye_corrected_vision><right_eye>1.0</right_eye><right_eye_corrected_vision>1.5</right_eye_corrected_vision><hearing></hearing><energizing_function></energizing_function><skin></skin><skin_other>皮肤</skin_other><sclera></sclera><sclera_other>巩膜</sclera_other><lymph_node></lymph_node><lymph_node_other>淋巴结</lymph_node_other><lung_barrel_chest></lung_barrel_chest><lung_sounds></lung_sounds><lung_sounds_exception></lung_sounds_exception><lung_rale></lung_rale><lung_rale_other>罗音</lung_rale_other><heart_rate>12</heart_rate><heart_rhythm></heart_rhythm><heart_noise></heart_noise><heart_noise_info>杂音</heart_noise_info><abdominal_tenderness></abdominal_tenderness><abdominal_tenderness_info>压痛</abdominal_tenderness_info><abdominal_mass></abdominal_mass><abdominal_mass_info>包块</abdominal_mass_info><abdominal_hepatomegaly></abdominal_hepatomegaly><abdominal_hepatomegaly_info>肝大</abdominal_hepatomegaly_info><abdominal_splenomegaly></abdominal_splenomegaly><abdominal_splenomegaly_info>脾大</abdominal_splenomegaly_info><shifting_dullness></shifting_dullness><shifting_dullness_info>移动性浊音</shifting_dullness_info><ramus_inferior_edema></ramus_inferior_edema><foot_arterial_pulse></foot_arterial_pulse><rectal_touch></rectal_touch><rectal_touch_other>肛门指诊</rectal_touch_other><mammary_gland>3|4|5</mammary_gland><mammary_gland_other>乳   腺</mammary_gland_other><gynae_vulva></gynae_vulva><gynae_vulva_exception>外阴</gynae_vulva_exception><gynae_cunt></gynae_cunt><gynae_cunt_exception>阴道</gynae_cunt_exception><gynae_cervix></gynae_cervix><gynae_cervix_exception>宫颈</gynae_cervix_exception><gynae_uterus></gynae_uterus><gynae_uterus_exception>宫体</gynae_uterus_exception><gynae_appendix></gynae_appendix><gynae_appendix_exception>附件</gynae_appendix_exception><others></others><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table><table name='et_symptom'><row><identity_number>513101193301152525</identity_number><staff_id>510824198308190834</staff_id><created>1321927473</created><symptom>9|10|21|22|25</symptom><symptom_other>体重下降</symptom_other><ext_uuid>5555</ext_uuid><org_id>511804201</org_id></row></table></tables>";
		echo $soapclient->ws_update($token,$xml_string);
	}	
public function test_deleteAction(){
		$soapclient = new SoapClient(__SITEROOT.'wsdl/api_phs_et_index.wsdl');
		$token      = $soapclient->ws_login('511802104','1');
		$xml_string="<?xml version='1.0' encoding='UTF-8'?><where><org_id>511802104</org_id><identity_number>513101193301152525</identity_number><ext_uuid>4324234</ext_uuid></where>";
		echo $soapclient->ws_delete($token,$xml_string);
	}
}
?>